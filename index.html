<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ë§Œì˜ CBT</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; color: #212529; }
        .container { max-width: 700px; margin: auto; background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .hidden { display: none; }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ ìˆ˜ì • */
        .button { width: 100%; padding: 12px; font-size: 1.1em; border-radius: 5px; cursor: pointer; margin-top: 10px; border: 1px solid #dee2e6; font-weight: bold; }
        .primary-button { background-color: #0d6efd; color: white; border-color: #0d6efd; }
        .secondary-button { background-color: #6c757d; color: white; border-color: #6c757d; }
        .light-button { background-color: #f8f9fa; color: #212529; } /* ê³¼ëª© ë²„íŠ¼ìš© ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .danger-button { background-color: #dc3545; color: white; border-color: #dc3545; }

        #auth-container { padding: 10px; text-align: right; border-bottom: 1px solid #eee; margin-bottom: 15px; }
        #auth-container button { width: auto; font-size: 0.9em; padding: 8px 12px; margin-left: 10px; }
        #auth-container span { font-size: 0.9em; }

        /* ... ê¸°íƒ€ ìŠ¤íƒ€ì¼ ... */
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box; font-size: 1em;}
        .question-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border: 1px solid #eee; border-radius: 5px; margin-bottom: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <div id="auth-container">
            <div id="logged-out-view">
                <button class="button secondary-button" onclick="showView('login-view')">ë¡œê·¸ì¸</button>
                <button class="button primary-button" onclick="showView('signup-view')">íšŒì›ê°€ì…</button>
            </div>
            <div id="logged-in-view" class="hidden">
                <span id="user-email"></span>
                <button class="button secondary-button" onclick="logOut()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>

        <div id="subject-view">
            <h2>ê³¼ëª© ì„ íƒ</h2>
            <div id="subject-list">ë¡œë”© ì¤‘...</div>
        </div>
        
        <div id="signup-view" class="hidden"><h2>íšŒì›ê°€ì…</h2> </div>
        <div id="login-view" class="hidden"><h2>ë¡œê·¸ì¸</h2> </div>
        <div id="quiz-view" class="hidden">
            <h2 id="quiz-header"></h2>
            <div id="quiz-body"></div>
            <hr style="margin: 20px 0;">
            <button class="button secondary-button" onclick="showManagementView()">ğŸ“‹ ë¬¸ì œ ê´€ë¦¬</button>
            <button class="button secondary-button" onclick="showView('subject-view')">â†©ï¸ ê³¼ëª© ì„ íƒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
        <div id="management-view" class="hidden"> </div>
        <div id="add-edit-view" class="hidden"> </div>
        <div id="bulk-add-view" class="hidden"> </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <script>
        // ì—¬ê¸°ì— ë³¸ì¸ì˜ firebaseConfig ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.
        const firebaseConfig = {
  apiKey: "AIzaSyBl4mNG0HVKLY159dPjJEuYZTp9_ay_guk",
  authDomain: "my-cbt-app-2cdb9.firebaseapp.com",
  projectId: "my-cbt-app-2cdb9",
  storageBucket: "my-cbt-app-2cdb9.firebasestorage.app",
  messagingSenderId: "1091430877229",
  appId: "1:1091430877229:web:1c4fae4ff852df4e1610a4"
};
        
        // Firebase ì´ˆê¸°í™”
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // ì „ì—­ ë³€ìˆ˜
        let currentSubjectId = null, currentSubjectData = {}, questions = [], currentQuiz = 0, score = 0, selectedOption = null, currentView = 'subject-view';
        const views = ['subject-view', 'quiz-view', 'management-view', 'add-edit-view', 'bulk-add-view', 'signup-view', 'login-view'];

        // í™”ë©´ ì „í™˜ í•¨ìˆ˜
        function showView(viewId) { /* ... ì´ì „ê³¼ ë™ì¼ ... */ }
        
        // --- ì¸ì¦ ê´€ë ¨ í•¨ìˆ˜ë“¤ ---
        auth.onAuthStateChanged(user => { /* ... ì´ì „ê³¼ ë™ì¼ ... */ });
        async function signUp() { /* ... ì´ì „ê³¼ ë™ì¼ ... */ }
        async function logIn() { /* ... ì´ì „ê³¼ ë™ì¼ ... */ }
        function logOut() { /* ... ì´ì „ê³¼ ë™ì¼ ... */ }

        // --- [ë³µì›ë¨] ê³¼ëª© ë° ë¬¸ì œ ê´€ë ¨ ì „ì²´ í•¨ìˆ˜ë“¤ ---
        
        async function loadSubjects() {
            showView('subject-view');
            const subjectListDiv = document.getElementById('subject-list');
            subjectListDiv.innerHTML = 'ê³¼ëª© ë¡œë”© ì¤‘...';
            const snapshot = await db.collection('subjects').orderBy('name').get();
            subjectListDiv.innerHTML = '';
            snapshot.forEach(doc => {
                const subject = doc.data();
                const button = document.createElement('button');
                button.textContent = `${subject.name} (${subject.questionCount || 0}ë¬¸ì œ)`;
                button.className = 'button light-button'; // ìŠ¤íƒ€ì¼ ìˆ˜ì •
                button.onclick = () => selectSubject(doc.id, subject);
                subjectListDiv.appendChild(button);
            });
        }
        
        function selectSubject(id, data) {
            currentSubjectId = id;
            currentSubjectData = data;
            document.getElementById('quiz-header').textContent = `${data.name} í€´ì¦ˆ`;
            showView('quiz-view');
            loadQuestionsForSubject();
        }

        async function loadQuestionsForSubject() {
            const quizBody = document.getElementById('quiz-body');
            quizBody.innerHTML = '<p>ë¬¸ì œ ë¡œë”© ì¤‘...</p>';
            const snapshot = await db.collection('subjects').doc(currentSubjectId).collection('questions').get();
            questions = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            currentQuiz = 0;
            score = 0;
            displayCurrentQuiz();
        }

        function displayCurrentQuiz() {
            const quizBody = document.getElementById('quiz-body');
            selectedOption = null;
            if (questions.length === 0) { /* ... ì½”ë“œ ìƒëµ ... */ return; }
            if (currentQuiz >= questions.length) { /* ... ì½”ë“œ ìƒëµ ... */ return; }
            quizBody.innerHTML = `
                <div id="question"></div>
                <ul class="options-container" id="options-container"></ul>
                <button id="submit-btn" class="button primary-button">ì •ë‹µ ì œì¶œ</button>`;
            const questionEl = document.getElementById('question');
            const optionsContainer = document.getElementById('options-container');
            const submitBtn = document.getElementById('submit-btn');
            const currentQuizData = questions[currentQuiz];
            questionEl.textContent = `${currentQuiz + 1}. ${currentQuizData.text}`;
            currentQuizData.options.forEach(optionText => {
                const li = document.createElement('li');
                li.className = 'option';
                li.textContent = optionText;
                li.onclick = () => {
                    const currentSelected = document.querySelector('.option.selected');
                    if (currentSelected) currentSelected.classList.remove('selected');
                    li.classList.add('selected');
                    selectedOption = optionText;
                };
                optionsContainer.appendChild(li);
            });
            submitBtn.onclick = submitAnswer;
        }

        function submitAnswer() {
            if (!selectedOption) return alert("ë³´ê¸°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!");
            if (selectedOption === questions[currentQuiz].answer) score++;
            currentQuiz++;
            displayCurrentQuiz();
        }

        // ë¬¸ì œ ê´€ë¦¬, ì¶”ê°€, ìˆ˜ì •, ì‚­ì œ ê´€ë ¨ ëª¨ë“  í•¨ìˆ˜ë“¤
        async function showManagementView() { /* ... ì´ì „ê³¼ ë™ì¼ ... */ }
        async function deleteQuestion(id, text) { /* ... ì´ì „ê³¼ ë™ì¼ ... */ }
        function showAddForm() { /* ... ì´ì „ê³¼ ë™ì¼ ... */ }
        function showEditForm(id) { /* ... ì´ì „ê³¼ ë™ì¼ ... */ }
        async function saveQuestion() { /* ... ì´ì „ê³¼ ë™ì¼ ... */ }
        async function addBulkQuestions() { /* ... ì´ì „ê³¼ ë™ì¼ ... */ }
        function addOptionField() { /* ... ì´ì „ê³¼ ë™ì¼ ... */ }
        function populatePartSelect(selectedValue) { /* ... ì´ì „ê³¼ ë™ì¼ ... */ }
        
        // í˜ì´ì§€ ì²« ë¡œë“œ
        loadSubjects();
    </script>
</body>
</html>
